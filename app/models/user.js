// Generated by CoffeeScript 1.7.1
var SALT_WORK_FACTOR;

SALT_WORK_FACTOR = 10;

module.exports = function(sequelize, DataTypes, bcrypt) {
  var User;
  User = sequelize.define('User', {
    email: {
      type: DataTypes.STRING,
      unique: true,
      allowNull: false
    },
    firstName: {
      type: DataTypes.STRING,
      allowNull: false
    },
    lastName: {
      type: DataTypes.STRING,
      allowNull: false
    },
    username: {
      type: DataTypes.STRING,
      unique: true,
      allowNull: false
    },
    password: {
      type: DataTypes.STRING,
      allowNull: false
    }
  }, {
    timestamps: true,
    instanceMethods: {
      comparePassword: function(userTypedPassword, callback) {
        return bcrypt.compare(userTypedPassword, this.password, (function(_this) {
          return function(err, isMatch) {
            if (err) {
              return callback(err);
            } else {
              return callback(null, isMatch);
            }
          };
        })(this));
      }
    }
  });
  User.beforeCreate(function(user, options, done) {
    return bcrypt.genSalt(SALT_WORK_FACTOR, function(err, salt) {
      if (err) {
        return done(err);
      }
      return bcrypt.hash(user.password, salt, function(err, hash) {
        if (err) {
          return done(err);
        }
        user.password = hash;
        return done();
      });
    });
  });
  return User;
};
